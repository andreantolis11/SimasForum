<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/dist/css/bootstrap.css}"/>
    <link rel="stylesheet" th:href="@{/css/thread.css}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <title>Thread Detail</title>
</head>
<body>
<div style="text-decoration: none;" th:replace="fragments/nav :: navbar"></div>

<div class="container" style="background-color: #FF5045; margin-top: 50px; padding: 15px; border-radius: 20px">
    <div class="box-container">
        <div class="thread-container">
            <div class="thread-content-container">
                <div>
                    <div th:text="${userName} + ', ' + ${threadDetail.datePost}"></div>
                </div>
                <h3 th:text="${threadDetail.title}"></h3>
                <div class="content" th:text="${threadDetail.content}"></div>
            </div>
            <div class="thread-vote-container">
                <form method="post" th:action="@{'/thread/{id}/{isUpVote}' (isUpVote=true, id=${threadDetail.id})}">
                    <button class="btn-upvote">
                        <span th:if="${upVotes == 1}" class="glyphicon glyphicon-menu-up up-vote"
                              style="color: red;"></span>
                        <span th:unless="${upVotes == 1}" class="glyphicon glyphicon-menu-up up-vote"></span>
                    </button>
                </form>
                <h4 th:text="${threadDetail.voteScore}">0</h4>
                <form method="post"
                      th:action="@{'/thread/{threadId}/{isUpVote}' (isUpVote=false, threadId=${threadDetail.id})}">
                    <button class="btn-downvote">
                        <span th:if="${upVotes == 0}" class="glyphicon glyphicon-menu-down" style="color: red;"></span>
                        <span th:unless="${upVotes == 0}" class="glyphicon glyphicon-menu-down"></span>
                    </button>
                </form>
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#exampleModal">
                    Report
                </button>
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Report</h5>
                            </div>
                            <div class="modal-body">
                                <form method="post"
                                      th:action="@{'/thread/report/{threadId}/{userId}' (threadId=${threadDetail.id}, userId=${userId})}">
                                    <div class="form-group">
                                        <label>Alasan</label>
                                        <input name="alasan" type="tel" class="form-control" id="alasan" placeholder="Alasan">
                                    </div>
<!--                                    <div class="modal-footer">-->
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary">Save changes</button>
<!--                                    </div>-->
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!--                <button type="button" onclick="getViews();">Get Views Count</button>-->
        </div>
        <div class="box-container">
            <div class="thread-container">
                <div class="thread-content-container">
                    <div>
                        <h2>Replies</h2>
                        <form th:action="@{'/reply/thread/{id}' (id=${threadDetail.id})}" method="post">
                            <div class="form-group">
                                <input name="content" style="background-color: #FFFFFF; border-radius: 5px;"
                                       type="text" class="form-control" id="reply" placeholder="Add a reply...">
                            </div>
                        </form>
                        <div th:if="${replies} != null">
                            <div class="thread-content-container" th:each="reply: ${replies}">
                                <div>
<!--                                    <h4 th:text="${reply.id}"></h4>-->
                                    <h4 th:text="${reply.content}" style="margin: 29px 0 0 0px;"></h4>
                                    <div style="display: flex;">
                                        <div style="display: flex">
                                            <form method="post" th:action="@{'/thread/{id}/{replyId}/{isUpVote}' (isUpVote=true, id=${threadDetail.id},replyId=${reply.id})}" style="margin: 10px 0 0 0px;">
                                                <button class="btn-upvote">
                                                    <!--                                        <span class="glyphicon glyphicon-menu-up up-vote"-->
                                                    <!--                                        style="color: red;"></span>                                        <span class="glyphicon glyphicon-menu-up up-vote"-->
                                                    <!--                                        style="color: red;"></span>-->
<!--                                                    <span class="glyphicon glyphicon-menu-up up-vote"></span>-->
                                                    <span th:if="${votesReply.get(reply.id) == true}" class="glyphicon glyphicon-menu-up up-vote" style="color: red;"></span>
                                                    <span th:unless="${votesReply.get(reply.id) == true}" class="glyphicon glyphicon-menu-up up-vote"></span>
                                                </button>
                                            </form>
                                            <h4 th:text="${reply.voteScore}" style="margin: 10px 0 0 10px;">0</h4>
                                            <form method="post" th:action="@{'/thread/{id}/{replyId}/{isUpVote}' (isUpVote=false, id=${threadDetail.id},replyId=${reply.id})}" style="margin: 10px 0 0 10px;">
                                                <button class="btn-downvote">
                                                    <!--                                        <span class="glyphicon glyphicon-menu-down" style="color: red;"></span>-->
<!--                                                    <span class="glyphicon glyphicon-menu-down"></span>-->
<!--                                                    <span th:if="${upVotes == 0}" class="glyphicon glyphicon-menu-down" style="color: red;"></span>-->
<!--                                                    <span class="glyphicon glyphicon-menu-down"></span>-->
                                                    <span th:if="${votesReply.get(reply.id) == false}" class="glyphicon glyphicon-menu-down" style="color: red;"></span>
                                                    <span th:unless="${votesReply.get(reply.id) == false}" class="glyphicon glyphicon-menu-down"></span>
                                                </button>
                                            </form>
                                        </div>
                                        <button style="padding: 0; border: none; background: none; margin: 8px 0 0 10px;">
                                            <a style="color: cornflowerblue;" th:onclick="|hide('r_form_'+${reply.id})|">reply</a>
                                        </button>
                                    </div>
                                    <form th:id="'r_form_'+${reply.id}"
                                          style="display: none; margin: 10px 0 0 0; width: 700px;"
                                          th:action="@{'/reply/reply/{id}' (id=${reply.id})}" method="post">
                                        <div class="form-group">
                                            <input name="content"
                                                   style="background-color: #FFFFFF; border-radius: 5px;"
                                                   type="text" class="form-control" th:id="${reply.id}"
                                                   placeholder="Add a reply...">
                                        </div>
                                    </form>
                                    <div style="margin: 20px 0 0 40px;" th:each="childreply : ${reply.replies}">
                                        <span th:text="${childreply.content}"></span>
                                        <div style="display: flex;">
                                            <div style="display: flex">
                                                <form method="post" th:action="@{'/thread/{id}/{replyId}/{isUpVote}' (isUpVote=true, id=${threadDetail.id},replyId=${childreply.id})}" style="margin: 10px 0 0 0px;">
                                                    <button class="btn-upvote">
                                                        <!--                                        <span class="glyphicon glyphicon-menu-up up-vote"-->
                                                        <!--                                        style="color: red;"></span>                                        <span class="glyphicon glyphicon-menu-up up-vote"-->
                                                        <!--                                        style="color: red;"></span>-->
<!--                                                        <span class="glyphicon glyphicon-menu-up up-vote"></span>-->
<!--                                                        <span th:if="${upVotes == 1}" class="glyphicon glyphicon-menu-up up-vote" style="color: red;"></span>-->
<!--                                                        <span class="glyphicon glyphicon-menu-up up-vote" th:id="'reply_form_'+${reply.id}"></span>-->
                                                        <span th:if="${votesReply.get(childreply.id) == true}" class="glyphicon glyphicon-menu-up up-vote" style="color: red;"></span>
                                                        <span th:unless="${votesReply.get(childreply.id) == true}" class="glyphicon glyphicon-menu-up up-vote"></span>
                                                    </button>
                                                </form>
                                                <h4 th:text="${childreply.voteScore}" style="margin: 10px 0 0 10px;">0</h4>
                                                <form method="post" th:action="@{'/thread/{id}/{replyId}/{isUpVote}' (isUpVote=false, id=${threadDetail.id},replyId=${childreply.id})}"style="margin: 10px 0 0 10px;">
                                                    <button class="btn-downvote">
                                                        <!--                                        <span class="glyphicon glyphicon-menu-down" style="color: red;"></span>-->
<!--                                                        <span class="glyphicon glyphicon-menu-down"></span>-->
<!--                                                        <span th:if="${upVotes == 0}" class="glyphicon glyphicon-menu-down" style="color: red;"></span>-->
<!--                                                        <span class="glyphicon glyphicon-menu-down"></span>-->
                                                        <span th:if="${votesReply.get(childreply.id) == false}" class="glyphicon glyphicon-menu-down" style="color: red;"></span>
                                                        <span th:unless="${votesReply.get(childreply.id) == false}" class="glyphicon glyphicon-menu-down"></span>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/webjars/bootstrap/5.1.3/dist/js/bootstrap.bundle.js}"></script>
<!--<script type="text/javascript" th:inline="javascript">-->
<!--    function getViews() {-->
<!--        alert("You've accessed " + history.length + " web pages in this session.");-->
<!--    }-->
<!--</script>-->
<script>
    function hide(id) {
        var x = document.getElementById(id);
        if (x.style.display === "none") {
            x.style.display = "";
        } else {
            x.style.display = "none";
        }
    }
</script>
</body>
</html>